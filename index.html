<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Omabytes Home</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
    <h1>A Journey into Fantasy.</h1>
  </header>

  <nav id="main">
    <ul>
      <li class="logo"><img onclick="smoothScroll(document.getElementsByTagName('header')[0].offsetTop, 300)" style="width:50px" src="https://www.svgrepo.com/show/175749/double-up-arrow.svg"></li>
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="publications.html">Publications</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  
  <div class="site-wrap">
    <p> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus elit dui, venenatis sed blandit eget, efficitur ac quam. Vestibulum laoreet cursus pharetra. Praesent tincidunt venenatis est, et tincidunt ligula interdum congue. Ut id orci eget magna porttitor rhoncus. In hac habitasse platea dictumst. Vivamus eleifend pulvinar odio a pretium. Aenean eros lectus, elementum ac fringilla eu, vulputate ut urna. Suspendisse vulputate lorem tincidunt, mollis tellus quis, vulputate velit. Sed luctus hendrerit sodales. Suspendisse sapien tellus, ornare a ipsum ac, pharetra condimentum orci. Maecenas maximus lectus nec scelerisque eleifend. Donec velit neque, pretium quis egestas in, tincidunt non mauris. Aliquam pulvinar diam non arcu tempus viverra. Nam interdum semper arcu, sed volutpat justo malesuada a. Donec a mattis justo, id rhoncus eros.
  
        Nullam ullamcorper ligula eu ipsum placerat, ac vestibulum ex malesuada. Pellentesque tempus pretium erat, id tristique odio mattis id. Nunc quis rutrum orci. Nunc consectetur consectetur vestibulum. Donec vitae enim a lectus finibus ullamcorper. Vivamus congue cursus odio, in interdum lacus mattis in. Vestibulum congue finibus mauris, vel venenatis urna vestibulum in. 
    </p>
    
    <div class="items">
      <div class="buffer"></div>
      <div class="item item1">01</div>
      <div class="item item2">02</div>
      <div class="item item3">03</div>
      <div class="item item4">04</div>
      <div class="item item5">05</div>
      <div class="item item6">06</div>
      <div class="item item7">07</div>
      <div class="item item8">08</div>
      <div class="item item9">09</div>
      <div class="item item10">10</div>
      <div class="item item11">11</div>
      <div class="item item12">12</div>
      <div class="item item13">13</div>
      <div class="item item14">14</div>
      <div class="item item15">15</div>
      <div class="item item16">16</div>
      <div class="item item17">17</div>
      <div class="item item18">18</div>
      <div class="item item19">19</div>
      <div class="item item20">20</div>
      <div class="item item21">21</div>
      <div class="item item22">22</div>
      <div class="item item23">23</div>
      <div class="item item24">24</div>
      <div class="buffer"></div>
    </div>
  </div>
  
  <script>

  const nav = document.querySelector("#main")
  let topOfNav = nav.offsetTop

  function fixNav() {
    if(window.scrollY >= topOfNav) {
      document.body.style.paddingTop = nav.offsetHeight + "px"
      document.body.classList.add("fixed-nav")
    } else {
      document.body.style.paddingTop = 0
      document.body.classList.remove("fixed-nav")
    }
  }

  window.addEventListener("scroll", fixNav)


  const everything = document.querySelector("body")
  const slider = document.querySelector('.items')
  const books = document.querySelectorAll(".item")
  let isDown = false
  let startX
  let scrollLeft

  slider.addEventListener('mousedown', (e) => {
    isDown = true;
    slider.classList.add('active')
    startX = e.pageX - slider.offsetLeft
    scrollLeft = slider.scrollLeft
  });

  slider.addEventListener('mouseleave', () => {
    isDown = false;
    slider.classList.remove('active')
  });

  slider.addEventListener('mouseup', () => {
    isDown = false;
    slider.classList.remove('active')
    if (document.selection) {
      document.selection.empty()
    } else {
      window.getSelection().removeAllRanges()
    }
  });

  slider.addEventListener('mousemove', (e) => {
    if (!isDown) return;  // stop the fn from running
    e.preventDefault();
    const x = e.pageX - slider.offsetLeft
    const walk = (x - startX) * 3
    slider.scrollLeft = scrollLeft - walk
  });

  function smoothScroll(offsetY,time) {
      if( !offsetY) return;
      var to = offsetY;
      var from = window.scrollY;
      var start = new Date().getTime(),
          timer = setInterval(function() {
              var step = Math.min(1,(new Date().getTime()-start)/time);
              window.scrollTo(0,(from+step*(to-from))+1);
              if( step == 1){ clearInterval(timer);};
          },1);
          window.scrollTo(0,(from+1));
      }

  function handleBookHover() {
    if(!this.classList.contains("viewed")) this.classList.add("hovered")
  }

  function handleBookUnhover() {
    this.classList.remove("hovered")
  }

  function handleBookClick() {
    let moving = false
    this.addEventListener("mousemove", () => {
      moving = true
    })
    let mouseUpEventRemove
    const mouseUpEvent = () => {
      if(!this.classList.contains("viewed")) {
        console.log(this.height)
        smoothScroll(this.parentNode.parentNode.offsetTop + this.offsetHeight / 2, 300)
        this.classList.add("viewed")
      } else if(!moving) {
        alert("link to book page")
      }
      mouseUpEventRemove()
    }
    mouseUpEventRemove = () => this.removeEventListener("mouseup", mouseUpEvent)
    this.addEventListener("mouseup",mouseUpEvent)
  }

  document.addEventListener("mousedown", function(e) {
    let element = document.querySelector(".item.viewed")
    if(element !== null) {
      let isClickInside = element.contains(e.target)
      if(!isClickInside) {
        element.classList.remove("viewed")
      }
    }
  })
  books.forEach(book => book.addEventListener("mouseover", handleBookHover))
  books.forEach(book => book.addEventListener("mouseleave", handleBookUnhover))
  books.forEach(book => book.addEventListener("mousedown", handleBookClick))
</script>

</body>
</html>
